# LittleVec

**LittleVec** — легковесная, эффективная по памяти векторная база данных.  
Позволяет быстро искать ближайшие вектора и хранить дополнительную информацию (payload) для каждого объекта.

Работает как плагин [RocksServer](https://github.com/valmat/RocksServer), установка максимально проста:  
**Установите плагин, запустите RocksServer — и начните пользоваться!**

---

## Преимущества

- Минималистичность: никаких лишних функций, только необходимый API
- Эффективность по памяти и скорости
- Очень простая интеграция в существующие процессы
- Поддержка нескольких независимых векторных баз
- Работает на самых маломощных серверах и VPS

---

## Быстрый старт

1. Установить RocksServer и плагин LittleVec (ссылки к инструкции).
2. Запустить RocksServer.
3. Взаимодействовать с LittleVec через HTTP API.

---

# API

## Работа с базами данных

### 1. Создание базы данных

**POST** `/create_vecdb`

```json
{
    "name": "<строковое имя базы данных>",
    "dim": <размерность вектора>,
    "dist": "<метрика расстояния (опционально)>"
}
```

**Пояснения:**
- **name** (строка) — обязательное уникальное имя базы
- **dim** (int) — обязательная размерность векторов
- **dist** (string, опционально) — "cos" (по умолчанию), "dot_prod", "l1", "l2"

**Пример запроса:**
```json
{
    "name": "my_vectors",
    "dim": 128,
    "dist": "cos"
}
```

**Возможные ошибки ответа:**
- 400: Некорректные параметры (`{"error": "Description of problem"}`)
- 409: База с таким именем уже существует (`{"error": "Database already exists"}`)


---

### 2. Удаление базы данных

**POST** `/delete_vecdb`
```json
{
    "name": "<имя базы данных>"
}
```

---

### 3. Обновление базы данных

**POST** `/update_vecdb`
```json
{
    "name": "<имя базы данных>",
    "dist": "<новая функция расстояния>"
}
```
*Менять можно только метрику расстояния*

---

## Операции с векторами (записями)

**Во всех следующих запросах обязательно поле `db_name` — имя рабочей базы данных!**

---

### 4. Добавление / обновление вектора

**POST** `/set_vectors`

```json
{
    "db_name": "my_vectors",
    "data": [
        {
            "id": "123",
            "vector": [0.1, 0.2, 0.3, ...],
            "payload": <любой json, опционально>
        },
        ...
    ]
}
```

- **id** (строка) — уникальный идентификатор
- **vector** — массив из dim числовых значений (float)
- **payload** — любой произвольный сериализуемый JSON (не обязательно)

---

### 5. Удаление вектора

**DELETE** `/delete_vectors`

```json
{
    "db_name": "my_vectors",
    "data": [
        {
            "id": "123"
        },
        ...
    ]
    
}
```

---

### 6. Поиск векторов

**POST** `/search_vectors`
```json
{
    "db_name": "my_vectors",
    "data": [
        {
            "vector": [0.1, 0.2, 0.3, ...],
            "extra": <любой json, опционально>
        },
        ...
        // Если нужно, запрос может содержать несколько векторов
    ],
    "top_k": 5,
    "dist": "..." // опционально, переопределяет dist, заданный при создании БД
}
```

**Ответ:**
```json
{
    "results": [
        {
            "nearest": [
                { "id": "123", "distance": 0.123, "payload": ... },
                ...
            ],
            "extra": ... // если extra был передан в запросе
        },
        ...
    ]
}
```

---

## Формат ошибок

Любая ошибка возвращается с соответствующим HTTP-кодом (например 400, 404, 409, 500 и т.д.)  
И в теле ответа обязательно содержится  
```json
{
  "error": "Описание ошибки"
}
```

**Частые ошибки:**
- 400: Некорректный формат запроса/ошибка валидации (например, не совпадает размерность векторов)
- 404: База данных или запись не найдена
- 409: Попытка создать уже существующую базу/запись
- 500: Внутренняя ошибка сервера

---

## Примеры запросов и ответов

_to do_

---

## FAQ (Вопросы и ответы)

- **Можно ли использовать разные базы одновременно?**  
  Да, имя базы всегда указывается явно в каждом запросе.

- **Есть ли ограничения на размер payload?**  
  Ограничено возможностями RocksDB.

- **Можно ли менять функцию расстояния на лету?**  
  В каждом поисковом запросе можно указать свою.

---

## License

LittleVec is licensed under the [MIT License](LICENSE).