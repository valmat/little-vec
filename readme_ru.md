# LittleVec

**LittleVec** — легковесная и эффективная по памяти векторная база данных.  
Позволяет быстро искать ближайшие векторы и хранить дополнительную информацию (payload) для каждого объекта.

Работает как плагин для [RocksServer](https://github.com/valmat/RocksServer).  
**Установите плагин, запустите RocksServer — и начинайте пользоваться!**

---

## Преимущества

- Минималистичный API: только необходимые функции, ничего лишнего
- Эффективность по памяти и скорости
- Простая интеграция
- Поддержка нескольких независимых векторных баз
- Работает даже на самых маломощных серверах и VPS

---

## Быстрый старт

1. Установите RocksServer и плагин LittleVec (см. инструкцию по установке).
2. Запустите RocksServer.
3. Используйте HTTP API LittleVec для работы с векторами и поиском.

---

# API

## Работа с базами данных

> Все операции с базами осуществляются через эндпоинты `/vecdb/...`

Во всех эндпоинтах этого раздела при успешном выполнении возвращается код ответа 200 и тело:
```json
{"success": true}
```

### 1. Создание базы данных

**POST** `/vecdb/create`

```json
{
    "name": "<имя_БД (строка)>",
    "dim": <размерность_векторов (int)>,
    "dist": "<метрика расстояния (опционально, см. ниже)>"
}
```

- **name** (строка, обязательно) — уникальное имя базы данных
- **dim** (int, обязательно) — размерность векторов
- **dist** (строка, опционально) — метрика: `"qcos"` (по умолчанию), `"cos"`, `"dot_prod"`, `"l1"`, `"l2"`

**Пример запроса**:
```json
{
    "name": "my_vectors",
    "dim": 128,
    "dist": "cos"
}
```

#### Возможные ошибки:
- 400: Некорректные параметры (`{"error": "Description of problem"}`)
- 409: База с таким именем уже существует (`{"error": "Database already exists"}`)

---

### 2. Удаление базы данных

**POST** `/vecdb/delete`

```json
{
    "name": "<имя_БД>"
}
```

---

### 3. Обновление параметров базы данных

**POST** `/vecdb/update`

```json
{
    "name": "<имя_БД>",
    "dist": "<новая метрика расстояния>"
}
```
> *Изменяется только метрика расстояния.*

---

## Операции с векторами

> Все операции с векторами осуществляются через эндпоинты `/vectors/...`  
> В каждом запросе обязательно указывайте поле `db_name` — имя рабочей базы данных.

---

### 4. Добавление / обновление векторов

**POST** `/vectors/set`

```json
{
    "db_name": "my_vectors",
    "data": [
        {
            "id": "123",
            "vector": [0.1, 0.2, 0.3, ...],
            "payload": <произвольный JSON, опционально>
        },
        ...
    ]
}
```
- **id** (строка) — уникальный идентификатор вектора
- **vector** (массив float) — длина должна соответствовать dim
- **payload** — произвольный сериализуемый объект (опционально)

В случае успеха возвращается код ответа 200 и тело:
```json
{"success": true}
```

---

### 5. Удаление векторов

**DELETE** `/vectors/delete`

```json
{
    "db_name": "my_vectors",
    "data": [
        { "id": "123" },
        ...
    ]
}
```

В случае успеха возвращается код ответа 200 и тело:
```json
{"success": true}
```

---

## Поиск ближайших векторов

### 6. Поиск по одному вектору

**POST** `/vectors/search`

```json
{
    "db_name": "my_vectors",
    "vector": [0.1, 0.2, 0.3, ...],
    "top_k": <количество ближайших векторов в ответе, опционально>,
    "dist": "<метрика, опционально>"  // переопределяет dist из базы
}
```

**Ответ:**
```json
{
    "nearest": [
        { "id": "123", "distance": 0.123, "payload": ... },
        ...
    ]
}
```

---

### 7. Batch-поиск по массиву векторов

**POST** `/vectors/batch_search`

```json
{
    "db_name": "my_vectors",
    "data": [
        {
            "vector": [0.1, 0.2, 0.3, ...],
            "extra": <любой JSON, опционально>
        },
        ...
    ],
    "top_k": <количество ближайших векторов в ответе, опционально>,
    "dist": "<метрика, опционально>"
}
```

**Ответ:**
```json
{
    "results": [
        {
            "nearest": [
                { "id": "123", "distance": 0.123, "payload": ... },
                ...
            ],
            "extra": ... // если был передан extra
        },
        ...
    ]
}
```

---

# Формат ошибок

Все ошибки возвращаются с соответствующим HTTP-статусом (400, 404, 409, 500 и др.).  
В теле ответа всегда присутствует:
```json
{
  "error": "Описание ошибки"
}
```

**Типичные ошибки:**
- 400: Некорректный запрос / ошибка валидации (например, размерность вектора не совпадает)
- 404: База или запись не найдена
- 409: Попытка создать уже существующую базу или запись
- 500: Внутренняя ошибка сервера

---

# Особенности

- В основе лежит [RocksDB](https://rocksdb.org/) — очень [эффективная БД](https://github.com/facebook/rocksdb) с поддержкой итераторов и высокой производительностью на SSD.

- Главная задача LittleVec — быть эффективной по памяти векторной БД. Низкое потребление ОЗУ: **15–20 Мб** даже при хранении миллионов векторов и гигабайтах данных.

- На миллионе векторов размерностью 50 запрос выполняется примерно за 60 мс.

- Нет шардинга и репликации: решение рассчитано на запуск в рамках одного сервера, но в этих условиях работает эффективно.

## Дополнительно

- В каждом запросе явно указывается имя базы данных, что позволяет использовать несколько баз одновременно.

- Лимит на размер payload определяется возможностями RocksDB и параметром `max_body_size` в RocksServer.
  
- В каждом поисковом запросе можно указать функцию расстояния вручную. Также метрику по умолчанию можно изменить, обновив параметры базы данных.

---

## License

LittleVec распространяется под лицензией [MIT License](LICENSE).
